## 词法阶段

在“作用域是什么”章节中，我们将`作用域`定义为一套规则，这套规则用来管理`引擎`如何在当前作用域以及嵌套的子作用域中根据标识符名称进行变量查找。

-------------------------------------------------------------

### 1.作用域的分类

1. `词法作用域` - 最普遍，被大多数编程语言所采用。

2. `动态作用域` - 仍有一些编程语言在使用，如 Bash 脚本、Perl中的一些模式。

-----------------------------------------------------------------

### 2.词法阶段

在“编译原理”章节中，我们知道，大部分标准语言编译器的第一个工作阶段叫`词法化`（也叫单词化）。词法化的过程会对源代码中的字符进行检查。如果是有状态的解析过程，还会赋予单词语义。

这个概念是理解`词法作用域`及其名称来历的基础。

简单地说，`词法作用域`就是定义在`词法阶段`的作用域。换句话说，`词法作用域`是由你在写代码时将变量和块作用域写在哪里来决定的。因此当`词法分析器`处理代码时会保持作用域不变。（大部分情况下是这样的）

> 注意：事实上，存在一些欺骗词法作用域的方法，这些方法在词法分析器处理过后依然可以修改作用域，但是非常不推荐。因此，让词法作用域根据词法关系保持书写时的自然关系不变，是一个非常好的最佳实践。

---------------------------------------------------------------

### 3.举例

```
	function foo(a) {
		var b = a * 2;
		
		function bar(c) {
			console.log(a, b, c)
		}
		
		bar( b * 3);
	}
	
	foo(2);
```

上面例子中，有三个逐级嵌套的作用域。为了帮助理解，可以将它们想象成几个逐级包含的气泡：

1. 全局作用域中，只有1个标识符： foo

2. foo所创建的作用域中，包含3个标识符： a, b, bar

3. bar所创建的作用域中，只有一个标识符： c


总结：**`每个函数都会创建一个新的作用域`**。

-----------------------------------------------------------------

### 4.查找

`作用域气泡`的结果和互相之间的位置关系给`引擎`提供了足够的位置信息。引擎用这些信息来`查找标识符`的位置。


对于上面的代码，查找过程如下：
		
`引擎`执行`console.log(..)`声明，并查找 a、 b、 c 三个变量的引用。它首先从最内部的作用域，也就是 bar()函数的`作用域气泡`开始查找。引擎无法在这里找到 a，因此会去上一级到所嵌套的 foo(..)的作用域中继续查找。在这里找到了 a，因此`引擎`使用了这个引用。对 b 来讲也是一样的。而对 c 来说，引擎在 bar(..) 中就能找到了它。


**`作用域查找会在找到第一个匹配的标识符时停止`**：

在多层嵌套的作用域中可以定义同名的标识符，这叫作`遮蔽效应`（内部的标识符“遮蔽”了外部的标识符）。抛开遮蔽效应，作用域查找始终从运行时所处的`最内部`作用域开始，逐级`向外`或者`向上`进行，直到遇见`第一个匹配的标识符`为止。

----------------------------------------------------------------

### 5. `全局变量`会自动成为`全局对象`的属性

重点： 全局变量会自动成为全局对象(比如浏览器中的window对象)的属性。因此可以不直接通过全局对象的词法名称，而是间接地通过全局对象属性的引用来对其进行访问。

	window.a
	
通过这种技术可以访问那些被同名变量所遮蔽的全局变量。但是`非全局变量`如果被遮蔽了，无论如何都`无法`被访问到。	

----------------------------------------------------------------

### 6. 无论函数在`哪里`被调用，也无论它`如何`被调用，它的词法作用域都只由函数`被声明`时所处的位置决定

----------------------------------------------------------------

### 7. 词法作用域查找`只会`查找`一级标识符`

比如， a、 b、 c。如果代码中引用了 foo.bar.baz，词法作用域查找只会试图查找 foo 标识符，找到这个变量后，`对象属性访问规则`会分别接管对 bar 和 baz属性的访问。


