## 作用域嵌套

我们说过，作用域是根据名称查找变量的一套规则。

-----------------------------------------------------------------------------------

### 1.`作用域嵌套`：

当一个块或函数嵌套在另一个块或函数中时，就发生了作用域嵌套。因此，当在`当前作用域`中无法找到某个变量时，`引擎`就会在外层嵌套的作用域中继续查找，直到找到该变量，
或抵达最外层的作用域（也就是`全局作用域`）为止。

```
	function foo(a) {
		console.log(a + b);
	}
	
	var b = 2;
	
	foo(2);
```

对 b 进行的 RHS 引用无法在函数foo内部完成，但可以在上一级作用域（在本例中是`全局作用域`）中完成。

--------------------------------------------------------------------------------

### 2.`引擎`和`作用域`对话如下：

引擎：嘿，foo的作用域，你见过 b 吗？我需要对它进行 RHS 引用。

foo作用域： 听到没听过，走开。

引擎：你好，foo的上级作用域，咦？有眼不识泰山，原来你是全局作用域大哥， 你见过 b 吗？我需要对它进行 RHS引用。

foo的上级作用域： 当然了，给你吧。

-------------------------------------------------------------------------------

### 3.遍历嵌套作用域链的规则：

`引擎`从当前的`执行作用域`开始查找变量，如果找不到，就向上一级继续查找。当抵达最外层的全局作用域时，无论找到还是没找到，查找过程都会停止。

------------------------------------------------------------------------------------

### 4.把作用域链比喻成一个建筑：

	   ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓	
	   ┃           global scope             ┃   ↑
	   ┃   ┏━┓    ┏━┓    ┏━┓    ┏━┓    ┏━┓  ┃   | 
	   ┃   ┗━┛    ┗━┛    ┗━┛    ┗━┛    ┗━┛  ┃   |
	   ┃                                    ┃   |  
	   ┃   ┏━┓    ┏━┓    ┏━┓    ┏━┓    ┏━┓  ┃   |
	   ┃   ┗━┛    ┗━┛    ┗━┛    ┗━┛    ┗━┛  ┃   | 词
	   ┃                                    ┃   | 法
	   ┃   ┏━┓    ┏━┓    ┏━┓    ┏━┓    ┏━┓  ┃   | 作
	   ┃   ┗━┛    ┗━┛    ┗━┛    ┗━┛    ┗━┛  ┃   | 用
	   ┃                                    ┃   | 域
	   ┃   ┏━┓    ┏━┓    ┏━┓    ┏━┓    ┏━┓  ┃   |
	   ┃   ┗━┛    ┗━┛    ┗━┛    ┗━┛    ┗━┛  ┃   |
	   ┃                                    ┃   |
	   ┃   ┏━┓    ┏━┓    ┏━┓    ┏━┓    ┏━┓  ┃   |
	   ┃   ┗━┛    ┗━┛    ┗━┛    ┗━┛    ┗━┛  ┃   |  
	   ┃                    current scope   ┃   | 
	   ┃                      ┏━━━━━━━━━┓   ┃   |
	   ┃                      ┃         ┃   ┃   |
	   ┃                      ┃         ┃   ┃   |
	   ┃                      ┃         ┃   ┃   |
	   ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
	   
这个建筑代表程序中的嵌套作用域链。第一层楼代表当前的执行作用域，也就你所处的位置。建筑的顶层代表全局作用域。

LHS 和 RHS 引用都会在当前楼层进行查找，如果没找到，就会坐电梯前往上一层楼，如果还是没有找到就继续向上，以此类推。

一旦抵达顶层（全局作用域），可能找到了你所需要的变量，也可能没找到，但无论如何查找过程都将停止。
	   
	   