##### 1. 浏览器的主要功能和构成

    主要功能：
        * 是将用户选择的web资源呈现出来，它需要从服务器请求资源，并将其显示在浏览器窗口中。
          资源的格式通常是HTML，也包括PDF,image及其他格式。

        * 用户URI（统一资源标识符）来指定请求资源的位置。

        * W3C是负责制定web标准的组织。
    
    主要构成：
        * 用户界面
        * 浏览器引擎-用来查询及操作渲染引擎的接口
        * 渲染引擎-用来显示请求的内容，例如请求内容为html,渲染引擎负责解析html及css,并将解析后的结果显示出来
        * 网络-用来完成网络调用，例如http请求，它具有平台无关的接口，可以在不同平台上工作。
        * UI后端
        * JS解释器-用来解释执行JS代码
        * 数据存储-属于持久层，浏览器需要在硬盘中保存类似cookie的各种数据，HTML5定义了web database技术，
                  这是一种轻量级完整的客户端存储技术
                
##### 2. 渲染引擎      
    
    * 渲染引擎的职责就是渲染，即在浏览器窗口中显示所请求的内容。
  
    * 默认情况下，渲染引擎可以显示html、xml文档及图片。
      它也可以借助插件（一种浏览器扩展）显示其他类型数据，例如PDF。

    * Firefox使用Geoko--Mozilla自主研发的渲染引擎
      Safari 和 Chrome 都使用webkit，webkit是一款开源渲染引擎
      
    * 渲染主流程（渲染引擎在取得内容之后的基本流程）
          解析html构建DOM tree ---> 构建 render tree ---> 布局 render tree ---> 绘制render tree
       
          图示：   
          (https://pic002.cnblogs.com/images/2011/265173/2011110316263715.png)
          
            parsing HTML                                   layout of the
            to construct   ------>  render tree   ------>   render tree   ------>  painting the
            the DOM tree            construction                                    render tree
      
          渲染引擎开始解析 html，并将标签转化为内容树中的DOM节点。
          接着，它解析外部CSS文件及<style>标签中的样式信息。
          这些样式信息以及html中的可见性指令将被用来构建另一棵树--render tree
          
          render树由一些包含颜色、大小等属性的矩形组成，它们将被按照正确的顺序显示到屏幕上。
          render树构建好之后，将会执行布局过程，它将确定每个节点在屏幕上的确切坐标。
          再下一步就是绘制，即遍历render树，并使用UI后端层绘制每个节点。
          
          注意：这个过程是逐步完成的，为了更好的用户体验，渲染引擎将会尽可能早的将内容呈现到屏幕上，
          不会等到所有的html都解析完成之后再去构建和布局render树。
          它是解析完一部分内容就显示一部分内容，同时，可能还在通过网络下载其余内容。
          
          图示：
          
          HTML -->  HTML Parser  -->  DOM Tree        Layout
                                          ↓             ↕
                                     Attachement -→ Render Tree →  Painting →  Display
                                          ↑
          Style --> CSS Parser ---> Style Rules
          Sheets
          
##### 3. 解析与DOM树构建（Parsing and DOM tree construction）   
        
        * 解析是渲染引擎中一个非常重要的过程。
        * 解析一个文档即将其转换为具有一定意义的结构---编码可以理解和使用的东西。解析的结果通常是表达
          文档结构的节点树，称为解析树或语法树。
          
        * 文法（Grammars）
            解析基于文档依据的语法规则---文档的语言或格式。每种可被解析的格式必须具有由词汇及语法规则
            组成的特定的文法，称为上下文无法文法。
            人类语法不具有这一特性，因此不能被一般的解析技术所解析。
            
        * 解析器---词法分析器（Parser-Lexer combination）
            解析可以分为两个子过程---词法分析和语法分析
            
            词法分析就是将输入分解为符号，符号是语言的词汇表--基本有效单元的集合。
            对于人类语言来说，它相当于我们字典中出现的所有单词。
            
            语法分析指对语言应用语法规则。
          
            解析器一般将工作分配给两个组件---词法分析器（有时也叫分词器）负责将输入分析为合法的符号，
            解析器则根据语言的语法规则分析文档结构，从而构建解析树，词法分析器知道怎么跳过空白和换行之类的无关字符。
            
            
       * 转换（Translation）
            很多时候，解析树并不是最终结果。解析一般在转换中使用---将输入文档转换为另一种格式。
            编译就是个例子，编译器在将一段源码编译成机器码的时候，先将源码解析为解析树，然后将
            该树转换为一个机器码文档。
            
            图示：编译流程如下
            
            Source Code → Parsing → Parse Tree → Translation → Machine Code
            
      * 解析器类型（Type of parsers）
            有两种基本类型： 自顶向下、自底向上
                1. 自顶向下：查看语法的最高层结构并试着匹配其中一个
                2. 自底向上：从输入开始，逐步将其转换为语法规则，从底层规则开始直到匹配高层规则
            
      * HTML解析器
            HTML解析器的工作是将html标识解析为解析树。
      
      * HTML文法定义
            W3C组织制定规范定义了HTML的词汇表和语法 
            
      * 非上下文无关文法
            不幸的是，所有传统解析方式都不适用于html....
      
      * DOM
            输出的树，也就是解析树，是由DOM元素及属性节点组成的。
            DOM是文档对象模型的缩写，它是html文档的对象表示,
            作为html元素的外部接口供js等调用。
            
            树的根是"document"对象
            
            DOM 和 标签基本是（但不完全是）一一对应的关系，例如，如下的标签：
            
            <html>
              <body>
                <p> Hello DOM </p>
                <div>
                  <img src="example.png"/>
                 </div>
              </body>
            </html> 
            
            将被转换为下面的DOM树：
                
                             html
                              ↓
                             body
                             ↙↘
                            p   div
                            ↓    ↓
                           text  img
       
      * CSS解析
          不同于html,css属于上下文无关文法，可以用前面所描述的解析器来解析。
          css规范定义了css的词法及语法文法。
          
      * 处理脚本及样式表的顺序（重点）
          1. 脚本
              web的模式是同步的，开发者希望解析到一个<script>标签时立即解析执行脚本，
              并阻塞文档的解析直到脚本执行完。
              如果脚本是外引的，则网络必须先请求到这个资源--这个过程也是同步的，会阻塞
              文档的解析直到资源被请求到。
              
              这个模式保持了很多年，并且在html4和html5中都特别指定：
              开发者可以将脚本标识为defer，以使其不阻塞文档解析，并且在文档解析结束后执行。
              html5增加了标记脚本为异步的选项，以使脚本的解析执行使用另一个线程。
         
         2. 预解析
              webkit和firefox都做了这个优化，当执行脚本时，另一个线程解析剩下的文档，并加载后面需要通过
              网络加载的资源。
              这种方式可以使资源并行加载从而使整体速度更快。
              需要注意的是，预解析并不改变DOM树，它将这个工作留给主解析过程，自己只解析外部资源的引用，
              比如外部脚本、样式表及图片。
              
         3. 样式表
              样式表采用另一种不同的模式。
              理论上，既然样式表不改变DOM树，也就没有必要停下文档解析等待它们，
              
              然而，存在一个问题，脚本可能在文档的解析过程中请求样式信息，
              如果样式还没有加载和解析，脚本将得到错误的值，显然这将会导致很多问题，
              这看起来是个边缘情况，但确实很常见。
              
              Firefox在存在样式表还在加载和解析时，阻塞所有的脚本。
              
              Chrome只在当脚本试图访问某些可能被未加载的样式表所影响的特定的样式属性时才阻塞脚本。
              
##### 4.渲染村构建（Render tree construction）
    * 当DOM树构建完成，浏览器开始构建另一棵树---渲染树。
    
    * 渲染树由元素显示序列中的可见元素组成，
      它是文档的可视化表示，构建棵树是为了以正确的顺序绘制文档内容。
      
    * Firefox将渲染树中的元素称为frames，webkit则用renderer或渲染对象来描述这些元素
    
    * 渲染树和DOM树的关系（重点）
        渲染对象和DOM元素相对应，但这种对应关系不是一对一的，不可见的DOM元素不会被插入渲染树。
        例如head元素。
        而且，display属性为none的元素也不会在渲染对中出现。
        （visibility属性为hidden的元素将出现在渲染树中）
               
##### 5. 布局（Layout）
    * 当渲染对象被创建并添加到树中，它们并没有位置和大小，计算这些值的过程称为layout或reflow
    
##### 6.绘制（Painting）
    * 绘制阶段，遍历渲染树并调用渲染对象的paint方法，将它们的内容显示在屏幕上，绘制使用UI基础组件。
  
    
4. 总结渲染引擎

    为用户提供网页浏览服务无疑是最重要的功能；

    浏览器的渲染引擎也叫浏览器内核；

    * `渲染引擎` - 能够将 HTML/CSS/Javascript文本及相应的`资源文件`转换成`图像`结果

    * `作用` - 将`资源文件`转化为`用户可见`的结果

    * 渲染引擎的种类 - Tridend(IE)、Gecko(FF)、webkit(Safari,chrome,android)等

    *  `介绍` - `Webkit`是由苹果2005年发起的一个开源项目，引起了众多公司的重视，几年间被很多公司所采用，在移动端更占据了垄断地位。更有甚者，开发出了基于Webkit的支持H5的web操作系统（如 chrome OS、Web OS）      